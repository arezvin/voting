/*C2*/SET SCHEMA PUBLIC
DROP TABLE user_role IF EXISTS
DROP TABLE vote IF EXISTS
DROP TABLE user IF EXISTS
DROP TABLE dish IF EXISTS
DROP TABLE restaurant IF EXISTS
DROP SEQUENCE global_seq IF EXISTS
CREATE SEQUENCE GLOBAL_SEQ AS INTEGER START WITH 100000
CREATE TABLE user\u000a(\u000a    id               INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,\u000a    name             VARCHAR(255)            NOT NULL,\u000a    email            VARCHAR(255)            NOT NULL,\u000a    password         VARCHAR(255)            NOT NULL,\u000a    registered       TIMESTAMP DEFAULT now() NOT NULL,\u000a    enabled          BOOLEAN   DEFAULT TRUE  NOT NULL\u000a)
CREATE UNIQUE INDEX users_unique_email_idx ON USER (email)
CREATE TABLE user_role\u000a(\u000a    user_id INTEGER NOT NULL,\u000a    role    VARCHAR(255),\u000a    CONSTRAINT user_roles_idx UNIQUE (user_id, role),\u000a    FOREIGN KEY (user_id) REFERENCES USER (id) ON DELETE CASCADE\u000a)
CREATE TABLE restaurant\u000a(\u000a    id               INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,\u000a    name             VARCHAR(255)            NOT NULL\u000a)
CREATE UNIQUE INDEX restaurants_unique_name_idx ON RESTAURANT (name)
CREATE TABLE dish\u000a(\u000a    id               INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,\u000a    date             Date                    NOT NULL,\u000a    name             VARCHAR(255)            NOT NULL,\u000a    price            DOUBLE                  NOT NULL,\u000a    restaurant_id    INTEGER                 NOT NULL,\u000a    FOREIGN KEY (restaurant_id) REFERENCES RESTAURANT (id) ON DELETE CASCADE\u000a)
CREATE UNIQUE INDEX dish_unique_restaurant_datetime_name_idx ON DISH (restaurant_id, date, name)
CREATE TABLE vote\u000a(\u000a    id               INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,\u000a    date             Date NOT NULL,\u000a    user_id          INTEGER   NOT NULL,\u000a    restaurant_id    INTEGER   NOT NULL,\u000a    FOREIGN KEY (user_id) REFERENCES USER (id) ON DELETE CASCADE,\u000a    FOREIGN KEY (restaurant_id) REFERENCES RESTAURANT (id) ON DELETE CASCADE\u000a)
CREATE UNIQUE INDEX vote_unique_user_date_idx ON VOTE (user_id, date)
DISCONNECT
/*C3*/SET SCHEMA PUBLIC
DISCONNECT
/*C4*/SET SCHEMA PUBLIC
ALTER SEQUENCE global_seq RESTART WITH 100000
INSERT INTO USER VALUES(100000,'User','user@yandex.ru','password','2021-02-08 14:16:03.467000',TRUE)
INSERT INTO USER VALUES(100001,'Admin','admin@gmail.com','admin','2021-02-08 14:16:03.467000',TRUE)
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100002
COMMIT
INSERT INTO USER_ROLE VALUES(100000,'USER')
INSERT INTO USER_ROLE VALUES(100001,'ADMIN')
COMMIT
INSERT INTO RESTAURANT VALUES(100002,'\u041a\u043e\u043d\u0442\u0438\u043d\u0435\u043d\u0442\u0430\u043b\u044c')
INSERT INTO RESTAURANT VALUES(100003,'\u041a\u0443\u0448\u0430\u0439 \u0445\u043e\u0440\u043e\u0448\u043e')
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100004
COMMIT
INSERT INTO DISH VALUES(100004,'2020-04-04','\u041a\u0443\u043b\u0438\u0447\u0438\u043a\u0438',15.5E0,100002)
INSERT INTO DISH VALUES(100005,'2020-04-04','\u0425\u043e\u043b\u043e\u0434\u0435\u0446',30.0E0,100002)
INSERT INTO DISH VALUES(100006,'2020-04-04','\u0410\u043a\u0440\u043e\u0448\u043a\u0430',31.1E0,100002)
INSERT INTO DISH VALUES(100007,'2020-05-05','\u041f\u044e\u0440\u044d',23.4E0,100003)
INSERT INTO DISH VALUES(100008,'2020-05-05','\u041a\u0440\u0430\u0431\u043e\u0432\u044c\u0435',27.0E0,100003)
INSERT INTO DISH VALUES(100009,'2020-05-05','\u0411\u043e\u0440\u0449\u044c',28.7E0,100003)
INSERT INTO DISH VALUES(100010,'2021-02-08','\u041e\u043b\u0438\u0432\u044c\u0435',20.2E0,100002)
INSERT INTO DISH VALUES(100011,'2021-02-08','\u041c\u0430\u043a\u0430\u0440\u043e\u043d\u044b \u043f\u043e \u0444\u043b\u043e\u0442\u0441\u043a\u0438',25.0E0,100002)
INSERT INTO DISH VALUES(100012,'2021-02-08','\u0420\u043e\u0441\u0441\u043e\u043b\u044c\u043d\u0438\u043a',28.2E0,100002)
INSERT INTO DISH VALUES(100013,'2021-02-08','\u041a\u0430\u0440\u043f\u0430\u0447\u043e',35.0E0,100002)
INSERT INTO DISH VALUES(100014,'2021-02-08','\u0424\u0443\u0430\u0433\u0440\u0430',40.4E0,100003)
INSERT INTO DISH VALUES(100015,'2021-02-08','\u041a\u0430\u0440\u043f\u0430\u0447\u043e',38.7E0,100003)
INSERT INTO DISH VALUES(100016,'2021-02-08','\u041b\u0430\u0437\u0430\u043d\u044c\u044f',45.0E0,100003)
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100017
COMMIT
DISCONNECT
/*C5*/SET SCHEMA PUBLIC
DISCONNECT
/*C6*/SET SCHEMA PUBLIC
DISCONNECT
